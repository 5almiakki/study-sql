SELECT MONTH(c2.START_DATE) AS MONTH, c1.CAR_ID AS CAR_ID, COUNT(*) AS RECORDS
FROM (
    SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE YEAR(START_DATE) = 2022 AND MONTH(START_DATE) BETWEEN 8 AND 10
    GROUP BY CAR_ID
    HAVING COUNT(CAR_ID) >= 5
) AS c1
JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY AS c2
ON c1.CAR_ID = c2.CAR_ID
WHERE YEAR(START_DATE) = 2022 AND MONTH(START_DATE) BETWEEN 8 AND 10
GROUP BY MONTH, CAR_ID
ORDER BY MONTH ASC, CAR_ID DESC;

# SELECT CAR_ID, MONTH(START_DATE) AS MONTH, COUNT(*)
# FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
# WHERE YEAR(START_DATE) = 2022 AND MONTH(START_DATE) BETWEEN 8 AND 10
# GROUP BY CAR_ID, MONTH
# ORDER BY CAR_ID, MONTH;

# 1: 10 (1)
# 2: 8, 8, 8, 8, 8, 9, 10 (7)
# 3: 10, 10 (2)
# 4: 9, 10, 10 (3)
# 5: 8, 8, 8, 8, 9 (5)
# 6: 8, 9, 10, 10 (4)
# 7: 8, 8, 8, 8, 9, 10 (6)
# 8: 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10 (16)
# 9: 8, 8, 8, 10 (4)

# SELECT CAR_ID
# FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
# WHERE YEAR(START_DATE) = 2022 AND MONTH(START_DATE) BETWEEN 8 AND 10
# GROUP BY CAR_ID
# HAVING COUNT(CAR_ID) >= 5
# ORDER BY CAR_ID;
